FROM node:24 AS builder

WORKDIR /app
COPY . .

ARG VITE_ELASTICSEARCH_HOST
ARG VITE_ELASTICSEARCH_API_KEY
ARG VITE_ELASTICSEARCH_INDEX

ENV VITE_ELASTICSEARCH_HOST=$VITE_ELASTICSEARCH_HOST
ENV VITE_ELASTICSEARCH_API_KEY=$VITE_ELASTICSEARCH_API_KEY
ENV VITE_ELASTICSEARCH_INDEX=$VITE_ELASTICSEARCH_INDEX

RUN npm install -g pnpm@latest-10
RUN pnpm install

RUN pnpm build

FROM node:24-slim

WORKDIR /app
COPY --from=builder /app/dist dist

RUN npm install -g http-server

EXPOSE 8080

CMD ["http-server", "dist"]
